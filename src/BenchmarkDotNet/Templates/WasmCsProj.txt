<Project Sdk="$SDKNAME$" DefaultTargets="publish">
  <PropertyGroup>
    <OriginalCSProjPath>$CSPROJPATH$</OriginalCSProjPath>
    <WasmPropsPath>$([System.IO.Path]::ChangeExtension('$(OriginalCSProjPath)', '.Wasm.props'))</WasmPropsPath>
    <WasmTargetsPath>$([System.IO.Path]::ChangeExtension('$(OriginalCSProjPath)', '.Wasm.targets'))</WasmTargetsPath>
    <WasmDataDir>$WASMDATADIR$</WasmDataDir>
    <WasmDataDir Condition="'$(WasmDataDir)' != ''">$([MSBuild]::NormalizeDirectory($(WasmDataDir)))</WasmDataDir>
  </PropertyGroup>

  <Import Project="$(WasmPropsPath)" Condition="Exists($(WasmPropsPath))" />

  <PropertyGroup>
    <OutputType>Exe</OutputType>
    <RuntimeConfig>Release</RuntimeConfig>
    <EnableDefaultCompileItems>false</EnableDefaultCompileItems>
    <TargetFramework>$TFM$</TargetFramework>
    <AllowUnsafeBlocks>true</AllowUnsafeBlocks>
    <AppDir>$(PublishDir)</AppDir>
    <AssemblyName>$PROGRAMNAME$</AssemblyName>
    <RuntimeIdentifier>browser-wasm</RuntimeIdentifier>
    <SuppressTrimAnalysisWarnings>true</SuppressTrimAnalysisWarnings>
    <RunAOTCompilation>$RUN_AOT$</RunAOTCompilation>
    <PublishTrimmed>$(RunAOTCompilation)</PublishTrimmed>
    <WasmGenerateRunV8Script>true</WasmGenerateRunV8Script>
    <ErrorOnDuplicatePublishOutputFiles>false</ErrorOnDuplicatePublishOutputFiles>
    <ValidateExecutableReferencesMatchSelfContained>false</ValidateExecutableReferencesMatchSelfContained>
    <EnableDefaultWasmAssembliesToBundle>false</EnableDefaultWasmAssembliesToBundle>
    <!-- Suppress warning for nuget package used in old (unsupported) tfm. -->
    <SuppressTfmSupportBuildWarnings>true</SuppressTfmSupportBuildWarnings>
    <StartupObject>BenchmarkDotNet.Autogenerated.UniqueProgramName</StartupObject>
  </PropertyGroup>

  <ItemGroup>
    <Compile Include="$CODEFILENAME$" Exclude="bin\**;obj\**;**\*.xproj;packages\**" />
    <!-- move this too? -->
    <TrimmerRootDescriptor Include="WasmLinkerDescription.xml" Condition="'$(RunAOTCompilation)' == 'true'" />
  </ItemGroup>

  <ItemGroup>
    <ProjectReference Include="$(OriginalCSProjPath)" />
  </ItemGroup>

  <!-- Begin copied settings from benchmarks project -->
  $COPIEDSETTINGS$
  <!-- End copied settings -->

  <PropertyGroup>
    <WasmBuildAppAfterThisTarget>PrepareForWasmBuild</WasmBuildAppAfterThisTarget>
  </PropertyGroup>

  <Target Name="PrepareForWasmBuild" AfterTargets="Publish">
    <ItemGroup>
      <WasmAssembliesToBundle Include="$(PublishDir)*.dll" Condition="'$(RunAOTCompilation)' != 'true'" />
      <WasmAssembliesToBundle Include="$(PublishDir)*.dll" Exclude="$(PublishDir)KernelTraceControl.dll" Condition="'$(RunAOTCompilation)' == 'true'" />
    </ItemGroup>
  </Target>

  <Import Project="$(WasmTargetsPath)" Condition="Exists($(WasmTargetsPath))" />
</Project>
