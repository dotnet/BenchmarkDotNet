using System;
using System.Diagnostics;
using System.Threading;
using System.Runtime.CompilerServices;
using BenchmarkDotNet;
using BenchmarkDotNet.Jobs;
using BenchmarkDotNet.Extensions;
using BenchmarkDotNet.Helpers;
using BenchmarkDotNet.Running;
$TargetTypeNamespace$
$TargetMethodReturnTypeNamespace$

$AdditionalLogic$

namespace BenchmarkDotNet.Autogenerated
{
    public class Program : global::$TargetTypeName$
    {
        private IJob job = Job.Default$TargetBenchmarkTaskArguments$; // TODO

        public static int Main(string[] args)
        {
            try
            {
                Program instance = new Program();
                $ParamsContent$

                instance.setupAction();
                instance.targetAction();
                instance.cleanupAction();

                System.Console.WriteLine();
                foreach (var infoLine in BenchmarkEnvironmentInfo.GetCurrent().ToFormattedString())
                {
                    System.Console.WriteLine("// {0}", infoLine);
                }
                System.Console.WriteLine();

                instance.RunBenchmark();

                return 0;
            }
            catch (Exception ex)
            {
                System.Console.WriteLine(ex);
                return -1;
            }
        }

        public Program()
        {
            setupAction = $SetupMethodName$;
            cleanupAction = $CleanupMethodName$;
            idleAction = Idle;
            targetAction = $TargetMethodName$;
        }

        $TargetMethodResultHolder$
        private Action setupAction;
        private Action cleanupAction;
        private $TargetMethodDelegateType$ targetAction;
        private $IdleMethodDelegateType$ idleAction;

        public void RunBenchmark()
        {
            new MethodInvoker().Invoke(job, $OperationsPerInvoke$, setupAction, targetAction, cleanupAction, idleAction);
        }

        private $IdleMethodReturnType$ Idle()
        {
            $IdleImplementation$
        }
    }
}
