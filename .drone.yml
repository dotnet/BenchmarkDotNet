#---------------------------------#
#      general configuration      #
#---------------------------------#

# branches to build
trigger:
  branch:
    exclude:
    - gh-pages

#---------------------------------#		
#       build configuration       #		
#---------------------------------#
kind: pipeline
name: arm

platform:
  os: linux
  arch: arm

steps:
- name: build
  image: mcr.microsoft.com/dotnet/runtime:6.0-bullseye-slim-arm32v7
  commands:
  - echo 'deb http://httpredir.debian.org/debian buster-backports main contrib non-free' | sudo tee -a /etc/apt/sources.list.d/debian-backports.list
  - apt-get update
  - apt-get --yes install sudo
  - sudo apt install libseccomp2 -t buster-backports
  - apt-get install -y --no-install-recommends gnupg dirmngr
    && rm -rf /var/lib/apt/lists/* 
    && export GNUPGHOME="$(mktemp -d)" 
    && gpg --batch --keyserver hkp://keyserver.ubuntu.com:80 --recv-keys 3FA7E0328081BFF6A14DA29AA6A19B38D3D831EF 
    && gpg --batch --export --armor 3FA7E0328081BFF6A14DA29AA6A19B38D3D831EF > /etc/apt/trusted.gpg.d/mono.gpg.asc 
    && gpgconf --kill all 
    && rm -rf "$GNUPGHOME" 
    && apt-key list | grep Xamarin 
    && apt-get purge -y --auto-remove gnupg dirmngr
  - echo "deb http://download.mono-project.com/repo/debian stable-stretch main" > /etc/apt/sources.list.d/mono-official-stable.list 
    && apt-get update 
    && apt-get install -y mono-runtime 
    && rm -rf /var/lib/apt/lists/* /tmp/*
  - apt-get update 
    && apt-get install -y binutils curl mono-devel ca-certificates-mono fsharp mono-vbnc nuget gettext libcurl4-openssl-dev libicu-dev libssl-dev libunwind8 clang-3.9 referenceassemblies-pcl 
    && rm -rf /var/lib/apt/lists/* /tmp/*
  - chmod +x build.sh
  - bash ./build.sh
